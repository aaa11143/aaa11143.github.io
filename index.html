<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>jump, jump!</title>
  <style>
    .button {
      height : 100px;
      width : 100px;
      font-size : 50px;
      text-align : center;
      font-weight : bold;
    }
  </style>
</head>
<body>
  <!-- <button onclick="playsound()">aa</button>
  <input id='x', placeholder="x">
  <input id='y', placeholder="y">
  <input id='width', placeholder="너비">
  <input id='height', placeholder="높이">
  <input id='color', placeholder="색">
  <button id="aa">만들기</button> 
  <position id="po"></position> -->
  <div style="text-align:center">
    <canvas id="canvas"></canvas><br>
    <button id="up" class="button">&#x2191</button><br>
    <button id="left" class="button" onclick="jumpMan.moving = true; jumpMan. movingLeft = true">&#x2190</button>
<h>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h>
    <button id="right" class="button" onclick="jumpMan.moving=true; jumpMan.movingLeft=false">&#x2192</button>
  </div>
  <script>
    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');

    if (window.innerWidth < window.innerHeight) {
      canvas.width = window.innerWidth - 50;
      canvas.height = window.innerWidth - 50;
    } else if (window.innerWidth > window.innerHeight) {
      canvas.width = window.innerHeight - 50;
      canvas.height = window.innerHeight - 50;
    } else {
      canvas.width = window.innerWidth - 50;
      canvas.height = window.innerWidth - 50;
    }

    var character = new Image();
    character.list = ["https://i.ibb.co/n8P6qBD/mario-move1.png", "https://i.ibb.co/y4MV1tJ/mario-move2.png", "https://i.ibb.co/K2r5ZNr/mario-move3.png", "https://i.ibb.co/yRy7FnH/mario-jump.png"];
    character.src = character.list[2];

    var bgi = new Image();
    bgi.src = "https://mblogthumb-phinf.pstatic.net/MjAxOTAzMDZfMTM3/MDAxNTUxODE0NTI0NDkz.RvXlYv6p5xPwXrOIPfABgFuiknuTn0iFZNuUguVYc_og.ii04J6D96C6FKQSXQzy9DABBNk7vNuU343nmAquhmZgg.JPEG.mong728/%EC%B4%88%EA%B3%A0%ED%99%94%EC%A7%88_%EC%BB%B4%ED%93%A8%ED%84%B0_%EB%B0%B0%EA%B2%BD%ED%99%94%EB%A9%B4_(7).jpg?type=w800";
  
    blockX = [150];
    blockY = [100];
    blockWidth = [50];
    blockHeight = [50];
    blockColor = ['red'];

    var jumpMan = {
      x: canvas.width / 10,
      y: canvas.height - canvas.height / 7.5,
      height: canvas.height / 7.5,
      width: canvas.height / 15,
      speed: canvas.width / 50,
      moving: false,
      movingLeft: false, 
      jumpingTime: 0,
      jumping: false,
      jumpable: true,
      draw() {
        ctx.fillStyle = 'green';
        ctx.fillRect(this.x, this.y - 50, this.width, this.height);
        ctx.drawImage(character, this.x, this.y - 50, this.width, this.height);
      },
      moveLeft() {
        if (this.x > 0) {
          this.x -= this.speed;
        }
      },
      moveRight() {
        if (this.x + this.width < canvas.width) {
          this.x += this.speed;
        }
      }
    }

    class Block {
      draw(x, y, width, height, color) {
        ctx.fillStyle = color;
        ctx.fillRect(x, y, width, height);
      }
    }

    function iteration() {
      animation = requestAnimationFrame(iteration);
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(bgi, 0, 0, canvas.width, canvas.height)
      jumpMan.draw();
      ctx.fillStyle = 'red'
      ctx.fillRect(0, 0, 10, canvas.height);
      ctx.fillRect(0, 0, canvas.width, 10);
      ctx.fillRect(canvas.width - 10, 0, 10, canvas.height);
      ctx.fillRect(0, canvas.height - 10, canvas.width, 10);

      for(i=0;i != blockX.length; i++) {
        block.draw(blockX[i], blockY[i], blockWidth[i], blockHeight[i], blockColor[i])
      }

      /* document.getElementById('aa').addEventListener('click', function() {
        //block.draw(parseInt(document.getElementById('x').value), parseInt(document.getElementById('y').value), 50, 50, 'black');
        blockX.push(parseInt(document.getElementById('x').value));
        blockY.push(parseInt(document.getElementById('y').value));
        blockWidth.push(parseInt(document.getElementById('width').value));
        blockHeight.push(parseInt(document.getElementById('height').value));
        blockColor.push(document.getElementById('color').value);
      }); */

      if (jumpMan.jumping) {
        jumpMan.y -= 5;
        jumpMan.jumpingTime += 1;
        if (jumpMan.jumpingTime == 10) { 
          jumpMan.jumping = false;
          jumpMan.jumpingTime = 0;
        }
      } else if (jumpMan.y + jumpMan.height / 2 < canvas.height) {  
        jumpMan.y += 6;
      }

      if (jumpMan.moving) {
        if (jumpMan.movingLeft) {
          jumpMan.moveLeft();
        } else {
          jumpMan.moveRight();
        }
      }
    }

    var block = new Block();

    iteration();

    /* canvas.addEventListener('touchstart', function (event) {
      var touchPosition = [event.touches[0].clientX, event.touches[0].clientY];

      if (touchPosition[1] < canvas.height / 3 && !jumpMan.jumping) {
        jumpMan.jumping = true;
      } 
      if (touchPosition[0] < canvas.width / 2) {
        jumpMan.moving = true;
        jumpMan.movingLeft = true;
      } else {
        jumpMan.moving = true;
        jumpMan.movingLeft = false;
      }
    });

    canvas.addEventListener('touchend', function (event) {
      jumpMan.moving = false;
    }); */

    document.getElementById('up').addEventListener('mousedown', function() {
      jumpMan.jumping = true;
    })

    document.getElementById('left').addEventListener('mousedown', function() {
      jumpMan.moving = true;
      jumpMan.movingLeft = true;
    })

    document.getElementById('right').addEventListener('mousedown', function() {
      jumpMan.moving = true;
      jumpMan.movingLeft = false;
    })

    document.getElementById('left').addEventListener('mouseup', function() {
      jumpMan.moving = false;
    })

    document.getElementById('right').addEventListener('mouseup', function() {
      jumpMan.moving = false;
    })

    /* function playsound() {
      var audio = new Audio('bgm.mp3');
      audio.play();
    } */
  </script>
</body>
</html>
