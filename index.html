
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>jump, jump!</title>
</head>
<body>
  <!-- <button onclick="playsound()">aa</button>
  <input id='x', placeholder="x">
  <input id='y', placeholder="y">
  <input id='width', placeholder="너비">
  <input id='height', placeholder="높이">
  <input id='color', placeholder="색">
  <button id="aa">만들기</button> 
  <position id="po"></position> -->
  <div style="text-align:center">
    <canvas id="canvas"></canvas>
  </div>
  <script>
    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');

    if (window.innerWidth < window.innerHeight) {
      canvas.width = window.innerWidth - 50;
      canvas.height = window.innerWidth - 50;
    } else if (window.innerWidth > window.innerHeight) {
      canvas.width = window.innerHeight - 50;
      canvas.height = window.innerHeight - 50;
    } else {
      canvas.width = window.innerWidth - 50;
      canvas.height = window.innerWidth - 50;
    }

    var character = new Image();
    character.list = ["https://i.ibb.co/n8P6qBD/mario-move1.png", "https://i.ibb.co/y4MV1tJ/mario-move2.png", "https://i.ibb.co/K2r5ZNr/mario-move3.png", "https://i.ibb.co/yRy7FnH/mario-jump.png"];
    character.src = character.list[2];
  
    blockX = [150];
    blockY = [100];
    blockWidth = [50];
    blockHeight = [50];
    blockColor = ['red'];

    var jumpMan = {
      x: canvas.width / 10,
      y: canvas.height,
      height: canvas.height /7.5,
      width: canvas.height / 15,
      speed: canvas.width / 50,
      moving: false,
      movingLeft: false, // 추가된 속성
      jumpingTime: 0,
      jumping: false,
      jumpable: true,
      draw() {
        ctx.fillStyle = 'green';
        ctx.fillRect(this.x, this.y - 50, this.width, this.height);
        ctx.drawImage(character, this.x, this.y - 50); // 이미지 그리기 추가
      },
      moveLeft() {
        if (this.x > 0) {
          this.x -= this.speed;
        }
      },
      moveRight() {
        if (this.x + this.width < canvas.width) {
          this.x += this.speed;
        }
      }
    }

    class Block {
      draw(x, y, width, height, color) {
        ctx.fillStyle = color;
        ctx.fillRect(x, y, width, height);
      }
    }

    function iteration() {
      animation = requestAnimationFrame(iteration);
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      jumpMan.draw();
      ctx.fillStyle = 'red'
      ctx.fillRect(0, 0, 10, canvas.height)
      ctx.fillRect(0, 0, canvas.width, 10)
      ctx.fillRect(canvas.width, canvas.height, -canvas.width, -10)
      ctx.fillRect(canvas.width, canvas.height, -10, -canvas.height)
      
      ctx.fillRect(jumpMan.x, jumpMan.y, 1, 1)

      //document.getElementById('po').innerHTML = `${canvas.height-100}, ${jumpMan.y}`
      for(i=0;i != blockX.length; i++) {
        block.draw(blockX[i], blockY[i], blockWidth[i], blockHeight[i], blockColor[i])
      }

      /* document.getElementById('aa').addEventListener('click', function() {
        //block.draw(parseInt(document.getElementById('x').value), parseInt(document.getElementById('y').value), 50, 50, 'black');
        blockX.push(parseInt(document.getElementById('x').value));
        blockY.push(parseInt(document.getElementById('y').value));
        blockWidth.push(parseInt(document.getElementById('width').value));
        blockHeight.push(parseInt(document.getElementById('height').value));
        blockColor.push(document.getElementById('color').value);
      }); */

      if (jumpMan.jumping) {
        jumpMan.y -= 5;
        jumpMan.jumpingTime += 1;
        if (jumpMan.jumpingTime == 10) { // 점프 시간이 60이 되면 점프 종료
          jumpMan.jumping = false;
          jumpMan.jumpingTime = 0;
        }
      } else if (jumpMan.y < canvas.height - 100) { // 점프 중이 아니면서 캐릭터가 땅에 있지 않으면 아래로 이동
        jumpMan.y += 6;
      }

      if (jumpMan.moving) {
        if (jumpMan.movingLeft) {
          jumpMan.moveLeft();
        } else {
          jumpMan.moveRight();
        }
      }
    }

    var block = new Block();

    iteration();

    canvas.addEventListener('touchstart', function (event) {
      var touchPosition = [event.touches[0].clientX, event.touches[0].clientY];

      if (touchPosition[1] < canvas.height / 3 && !jumpMan.jumping) {
        jumpMan.jumping = true;
      } else if (touchPosition[0] < canvas.width / 2) {
        jumpMan.moving = true;
        jumpMan.movingLeft = true;
      } else {
        jumpMan.moving = true;
        jumpMan.movingLeft = false;
      }
    });

    canvas.addEventListener('touchend', function (event) {
      jumpMan.moving = false;
    });

    /* function playsound() {
      var audio = new Audio('bgm.mp3');
      audio.play();
    } */
  </script>
</body>
</html>
